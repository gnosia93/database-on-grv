## 마이그레이션 하기 ##

카프카 ARN 및 브로커 리스트를 조회한다.
```
KAFKA_ARN=$(aws kafka list-clusters --query "ClusterInfoList[?ClusterName=='msk-grav'].ClusterArn" --output text)
BROKER_STRING=$(aws kafka get-bootstrap-brokers --cluster-arn ${KAFKA_ARN} --query BootstrapBrokerString)

echo ${BROKER_STRING}
```

#### 1. 프로듀서 / 컨슈머 실행하기 ####

grav-ec2-instance 로 로그인하여 카프카 클라이언트를 설치하고, 토픽을 생성한다.  
```
yum list | grep java-17
sudo yum install -y java-17-amazon-corretto.x86_64
sudo yum install -y java-17-amazon-corretto-devel.x86_64

wget https://archive.apache.org/dist/kafka/3.6.0/kafka_2.13-3.6.0.tgz
tar xvfz kafka_2.13-3.6.0.tgz 
cd kafka_2.13-3.6.0/
```

`<BROKER_STRING>` 을 위에서 조회한 값으로 대체한 후, 토픽을 생성한다. 
```
bin/kafka-topics.sh --create --topic grav-mig-topic --partitions 3  --replication-factor 3 \
--bootstrap-server <BROKER_STRING>
```
![](https://github.com/gnosia93/managed-grv-mig/blob/main/tutorial/images/msk-03.png)


#### 2. 클러스터를 그라비톤으로 전환하기 ####


브로커 타입을 그라비톤으로 변경한다. 
```
aws kafka update-broker-type --cluster-arn ${KAFKA_ARN} --current-version "3.6.0" \
--target-instance-type "kafka.m7g.xlarge"
```

## 레퍼런스 ##
* [Getting Started with Apache Kafka and Python](https://developer.confluent.io/get-started/python/?utm_medium=sem&utm_source=google&utm_campaign=ch.sem_br.nonbrand_tp.prs_tgt.dsa_mt.dsa_rgn.apac_lng.eng_dv.all_con.confluent-developer&utm_term=&creative=&device=c&placement=&gad_source=1&gclid=Cj0KCQiA1p28BhCBARIsADP9HrPKZ2L5FL33Qj2hG5wD-SgO6VAhZTPCmRDyU3SzMKXwfxM4pEn5NX0aAuI6EALw_wcB)

* [카프카 예제](https://dev-records.tistory.com/entry/%ED%8C%8C%EC%9D%B4%EC%8D%AC%EC%9C%BC%EB%A1%9C-Kafka-%EA%B0%84%EB%8B%A8%ED%95%9C-%EC%98%88%EC%A0%9C)
